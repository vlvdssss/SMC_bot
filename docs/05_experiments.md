# 05. Эксперименты

## Назначение

Этот документ содержит **ВСЕ эксперименты** по улучшению стратегий.

Эксперименты **НЕ хранятся в коде**. Только здесь, в документации.

---

## Формат записи эксперимента

Каждый эксперимент должен содержать:

```markdown
## Эксперимент #N: Название

**Инструмент**: XAUUSD / US30 / и т.д.  
**Дата**: YYYY-MM-DD  
**Гипотеза**: Что мы проверяем  
**Изменения**: Что конкретно поменяли  
**Результаты**: Метрики (WR, DD, PF и т.д.)  
**Статус**: PASS / FAIL  
**Вывод**: Что делать дальше
```

---

## Правила экспериментов

### ✅ Что делать:
- Четко формулировать гипотезу
- Тестировать на минимум 100 сделках
- Сравнивать с baseline
- Документировать ВСЕ результаты (даже неудачные)

### ❌ Что НЕ делать:
- Не менять несколько параметров одновременно
- Не "подгонять" под исторические данные
- Не cherry-picking периодов ("только 2024 год")
- Не останавливаться после первой неудачи (может быть fluke)

---

## Список экспериментов

*(В данный момент экспериментов нет — фреймворк только создан)*

---

## Шаблон для будущих экспериментов

### Пример 1: Фильтр по волатильности

```markdown
## Эксперимент #1: Фильтр по ATR для XAUUSD

**Инструмент**: XAUUSD  
**Дата**: 2025-12-20  
**Гипотеза**: Пропуск сигналов в периоды низкой волатильности улучшит WR  
**Изменения**:  
- Рассчитываем ATR(14) на H1
- Если ATR < 5.0 USD → skip signal

**Результаты**:
- Baseline: WR 64%, DD -6.4%, Trades 150
- With filter: WR 68%, DD -5.2%, Trades 95

**Статус**: PASS ✅  
**Вывод**: Фильтр работает. Добавить в production стратегию.
```

---

### Пример 2: Изменение таймфрейма

```markdown
## Эксперимент #2: HTF H4 вместо H1 для XAUUSD

**Инструмент**: XAUUSD  
**Дата**: 2025-12-22  
**Гипотеза**: Использование H4 как HTF даст более стабильное направление  
**Изменения**:  
- HTF: H1 → H4
- Setup остался M15

**Результаты**:
- Baseline (H1): WR 64%, Trades 150
- H4 version: WR 58%, Trades 45

**Статус**: FAIL ❌  
**Вывод**: H4 слишком медленный для золота. Пропускаем много хороших входов. Остаёмся на H1.
```

---

### Пример 3: Дополнительный trigger

```markdown
## Эксперимент #3: Добавление Liquidity Grab для US30

**Инструмент**: US30  
**Дата**: 2025-12-25  
**Гипотеза**: Liquidity grab перед входом снизит false signals для индекса  
**Изменения**:  
- Перед входом проверяем: была ли ликвидность захвачена?
- Liquidity grab = sweep of high/low + reversal

**Результаты**:
- Baseline: WR 42%, DD -8.5%, Trades 120
- With LiqGrab: WR 55%, DD -6.2%, Trades 80

**Статус**: PASS ✅  
**Вывод**: Для индексов liquidity grab критичен. Добавить в стратегию.
```

---

## Как проводить эксперимент

### Шаг 1: Сформулировать гипотезу
Четко: "Что мы проверяем?"

Пример:
- ✅ "Фильтр по ATR > 5.0 улучшит WR"
- ❌ "Попробуем что-нибудь изменить"

---

### Шаг 2: Изменить код
Создать **отдельную ветку** или **копию стратегии**:
```
strategies/xauusd/strategy_exp1.py
```

Не править оригинал до подтверждения результатов.

---

### Шаг 3: Запустить backtest
```powershell
python tests/backtests/run_xauusd_exp1.py --period 2023-2024
```

Тестировать на минимум:
- 100 сделок
- 6 месяцев данных
- Несколько разных рыночных условий (trend, range, high vol, low vol)

---

### Шаг 4: Сравнить с baseline
Ключевые метрики:
- **Win Rate**: Улучшился?
- **Max Drawdown**: Уменьшился?
- **Profit Factor**: Вырос?
- **Total Trades**: Не упало ли слишком сильно?

Если WR +5%, но Trades -80% → это не улучшение (слишком мало сигналов).

---

### Шаг 5: Документировать
**Обязательно** записать в этот файл (05_experiments.md), даже если эксперимент FAILED.

Неудачные эксперименты = знание о том, что НЕ работает.

---

### Шаг 6: Принять решение

**Если PASS**:
- Перенести изменения в production стратегию
- Обновить документацию (04_strategies.md)
- Запустить full backtest (2-3 года)

**Если FAIL**:
- Оставить как есть
- Документировать, почему не сработало
- Искать другой подход

---

## Метрики для оценки

Эксперимент считается успешным, если:

✅ **Win Rate**: +3% или выше  
✅ **Max Drawdown**: -1% или ниже  
✅ **Profit Factor**: +0.2 или выше  
✅ **Total Trades**: Не снизилось более чем на 50%

Если хотя бы 3 из 4 метрик улучшились → PASS.

---

## История экспериментов

*(Пока пусто — фреймворк только создан)*

По мере тестирования стратегий, эксперименты будут добавляться сюда.

---

## Примеры идей для будущих экспериментов

### Для XAUUSD:
- Фильтр по ATR (волатильность)
- Фильтр по времени (skip Asian session?)
- Изменение RR (1:2 → 1:3)
- Использование M5 trigger вместо M15
- Добавление второго HTF (D1 для глобального направления)

### Для US30:
- Строгий фильтр по NY session (14:30-16:00 UTC)
- Фильтр по VIX (волатильность рынка)
- Использование объемов (если доступны)
- Liquidity grab обязательное условие

### Для всех инструментов:
- Partial TP (закрывать 50% на 1R, остальное на 2R)
- Breakeven move (передвинуть SL в BE после +1R)
- Trailing SL (по ATR или фиксированный)

---

**Важно**: Эксперименты проводятся **ПОСЛЕ** того, как baseline стратегия уже работает и протестирована. Не оптимизируем то, что ещё не работает.

---

**Версия**: 1.0  
**Дата**: 17 декабря 2025
